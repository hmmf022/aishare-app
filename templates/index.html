{% extends 'base.html' %}
{% block title %}共有チャット一覧 - {{ super() }}{% endblock %}
{% block content %}
<section class="post-list">
    <h2>チャット一覧</h2>
    <div class="controls">
        <form id="filter-sort-form" action="{{ url_for('index') }}" method="get" class="filter-controls">
            <div class="control-group search-group">
                <label for="search-keyword">キーワード</label>
                <input type="search" id="search-keyword" name="q" placeholder="タイトル, タグ..." value="{{ search_keyword or '' }}">
            </div>
            <div class="control-group">
                <label for="date-filter">投稿日</label>
                <input type="date" id="date-filter" name="date" value="{{ selected_date or '' }}">
            </div>
            <div class="control-group">
                <label for="tag-filter">タグ</label>
                <select name="tag" id="tag-filter">
                    <option value="">すべて</option>
                    {% for tag in all_tags %}
                    <option value="{{ tag.name }}" {% if tag.name == selected_tag %}selected{% endif %}>#{{ tag.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="control-group">
                <label for="sort-by">並び替え</label>
                <div class="sort-group">
                    <select name="sort" id="sort-by">
                        <option value="created_at" {% if current_sort == 'created_at' %}selected{% endif %}>投稿日時</option>
                        <option value="likes_count" {% if current_sort == 'likes_count' %}selected{% endif %}>いいね数</option>
                    </select>
                    <select name="order">
                        <option value="desc" {% if current_order == 'desc' %}selected{% endif %}>新しい順 / 多い順</option>
                        <option value="asc" {% if current_order == 'asc' %}selected{% endif %}>古い順 / 少ない順</option>
                    </select>
                </div>
            </div>
            <div class="control-group button-group">
                <button type="submit" class="apply-filters-btn">絞り込み適用</button>
                <a href="{{ url_for('index') }}" class="clear-filters-btn">リセット</a>
            </div>
        </form>
    </div>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th class="col-title">タイトル</th><th class="col-tags">タグ</th><th class="col-date">投稿日時</th>
                    <th class="col-likes">いいね</th><th class="col-actions">アクション</th>
                </tr>
            </thead>
            <tbody>
                {% for post in posts %}
                <tr data-post-id="{{ post.id }}">
                    <td><a href="{{ post.url }}" target="_blank" rel="noopener noreferrer">{{ post.title }}</a></td>
                    <td class="tags-cell">
                        {% if post.tags %}{% for tag_name in post.tags.split(',') %}<span class="tag">#{{ tag_name }}</span>{% endfor %}{% endif %}
                    </td>
                    <td>{{ post.created_at.split(' ')[0] if post.created_at else '' }}</td>
                    <td class="likes-cell"><span class="like-count">{{ post.likes_count }}</span></td>
                    <td class="actions-cell">
                        <button class="like-btn {% if post.is_liked %}active{% endif %}" data-post-id="{{ post.id }}" title="いいね">{% if post.is_liked %}♥{% else %}♡{% endif %}</button>
                        <button class="favorite-btn {% if post.is_favorited %}active{% endif %}" data-post-id="{{ post.id }}" title="お気に入り">{% if post.is_favorited %}★{% else %}☆{% endif %}</button>
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="5" class="no-posts">条件に合うチャットはありません。</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endblock %}
